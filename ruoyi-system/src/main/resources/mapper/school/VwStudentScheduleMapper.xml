<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.school.mapper.VwStudentScheduleMapper">

    <resultMap type="com.ruoyi.school.domain.VwStudentSchedule" id="VwStudentScheduleResult">
        <id     property="id"            column="id" />
        <result property="studentId"     column="student_id" />
        <result property="studentName"   column="student_name" />
        <result property="courseId"      column="course_id" />
        <result property="courseName"    column="course_name" />
        <result property="teacherId"     column="teacher_id" />
        <result property="teacherName"   column="teacher_name" />
        <result property="semester"      column="semester" />
        <result property="classTime"     column="class_time" />
        <result property="classPlace"    column="class_place" />
        <result property="status"        column="status" />
        <result property="isSelected"    column="is_selected" />
        <result property="credit"        column="credit" />
        <result property="createTime"    column="create_time" />
        <result property="updateTime"    column="update_time" />
    </resultMap>

        <!--
            vw_student_schedule 视图字段：
                selection_id, student_id, semester, course_id, course_name, teacher_id, teacher_name,
                day_of_week, lesson_start, lesson_end, week_start, week_end, week_type,
                classroom_id, class_status, capacity, selected_num, class_time_text

            这里做必要的别名填充，保证导出不报“未知列”错误：
                id           <- selection_id
                class_place  <- classroom_id
                status       <- class_status
                class_time   <- class_time_text
                student_name / create_time / update_time 视图中无对应列，使用 NULL 占位
        -->
        <sql id="selectVwStudentScheduleVo">
                select
                        v.selection_id as id,
                        v.student_id,
                        null as student_name,
                        v.course_id,
                        v.course_name,
                        v.teacher_id,
                        v.teacher_name,
                        v.semester,
                        v.class_time_text as class_time,
                        v.classroom_id as class_place,
                        v.class_status as status,
                        1 as is_selected,
                        c.credit as credit,
                        null as create_time,
                        null as update_time
                from vw_student_schedule v
                left join stu_course c on v.course_id = c.course_id
        </sql>

    <select id="selectVwStudentScheduleList" parameterType="com.ruoyi.school.domain.VwStudentSchedule" resultMap="VwStudentScheduleResult">
        <include refid="selectVwStudentScheduleVo" />
        <where>
            <if test="studentId != null and studentId != ''"> and v.student_id = #{studentId}</if>
            <if test="studentName != null and studentName != ''"> and student_name like concat('%', #{studentName}, '%')</if>
            <if test="courseId != null and courseId != ''"> and v.course_id = #{courseId}</if>
            <if test="courseName != null and courseName != ''"> and v.course_name like concat('%', #{courseName}, '%')</if>
            <if test="teacherId != null and teacherId != ''"> and v.teacher_id = #{teacherId}</if>
            <if test="teacherName != null and teacherName != ''"> and v.teacher_name like concat('%', #{teacherName}, '%')</if>
            <if test="semester != null and semester != ''"> and v.semester = #{semester}</if>
            <if test="classTime != null and classTime != ''"> and class_time like concat('%', #{classTime}, '%')</if>
            <if test="classPlace != null and classPlace != ''"> and class_place like concat('%', #{classPlace}, '%')</if>
            <if test="status != null"> and status = #{status}</if>
        </where>
    </select>

    <select id="selectVwStudentScheduleById" parameterType="Long" resultMap="VwStudentScheduleResult">
        <include refid="selectVwStudentScheduleVo" />
        where id = #{id}
    </select>
</mapper>
